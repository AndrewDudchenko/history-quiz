<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UA History Trainer</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Segoe UI', 'Roboto', 'Helvetica', 'Arial', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Å—Ç–∏–ª—ñ –¥–ª—è 3D –µ—Ñ–µ–∫—Ç—ñ–≤ */
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        
        /* –ê–Ω—ñ–º–∞—Ü—ñ—è –∫–æ–Ω—Ñ–µ—Ç—ñ */
        @keyframes fall {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // –û—Ç—Ä–∏–º—É—î–º–æ React —Ö—É–∫–∏ —Ç–∞ —ñ–∫–æ–Ω–∫–∏ –∑ –≥–ª–æ–±–∞–ª—å–Ω–∏—Ö –æ–±'—î–∫—Ç—ñ–≤
        const { useState, useEffect, useMemo } = React;

        // –û—Å–∫—ñ–ª—å–∫–∏ lucide —É CDN –ø—Ä–∞—Ü—é—î —á–µ—Ä–µ–∑ global object, —Å—Ç–≤–æ—Ä—é—î–º–æ –æ–±–≥–æ—Ä—Ç–∫—É
        const LucideIconWrapper = ({ iconName, size, className }) => {
            React.useEffect(() => {
                lucide.createIcons();
            });
            return <i data-lucide={iconName} style={{ width: size, height: size }} className={className}></i>;
        };

        // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ —ñ–∫–æ–Ω–æ–∫
        const IconMoon = (props) => <LucideIconWrapper iconName="moon" {...props} />;
        const IconSun = (props) => <LucideIconWrapper iconName="sun" {...props} />;
        const IconRotateCcw = (props) => <LucideIconWrapper iconName="rotate-ccw" {...props} />;
        const IconCheckCircle = (props) => <LucideIconWrapper iconName="check-circle" {...props} />;
        const IconXCircle = (props) => <LucideIconWrapper iconName="x-circle" {...props} />;
        const IconTrophy = (props) => <LucideIconWrapper iconName="trophy" {...props} />;
        const IconBookOpen = (props) => <LucideIconWrapper iconName="book-open" {...props} />;
        const IconGraduationCap = (props) => <LucideIconWrapper iconName="graduation-cap" {...props} />;
        const IconShuffle = (props) => <LucideIconWrapper iconName="shuffle" {...props} />;
        const IconHelpCircle = (props) => <LucideIconWrapper iconName="help-circle" {...props} />;
        const IconClock = (props) => <LucideIconWrapper iconName="clock" {...props} />;
        const IconStar = (props) => <LucideIconWrapper iconName="star" {...props} />;
        const IconGrid = (props) => <LucideIconWrapper iconName="grid" {...props} />;
        const IconPlay = (props) => <LucideIconWrapper iconName="play" {...props} />;

        const UAHistoryTrainer = () => {
            const [activeTab, setActiveTab] = useState('cards');
            const [isDark, setIsDark] = useState(false);
            const [xp, setXp] = useState(0);
            const [visitedCards, setVisitedCards] = useState(new Set());

            const ranks = [
                { name: "–¢—É—Ä–∏—Å—Ç", minXp: 0, icon: "üéí" },
                { name: "–°—Ç—É–¥–µ–Ω—Ç", minXp: 100, icon: "üìì" },
                { name: "–î–æ—Å–ª—ñ–¥–Ω–∏–∫", minXp: 300, icon: "üîç" },
                { name: "–Ü—Å—Ç–æ—Ä–∏–∫", minXp: 600, icon: "üìú" },
                { name: "–ü—Ä–æ—Ñ–µ—Å–æ—Ä", minXp: 1000, icon: "üéì" },
                { name: "–ì–µ—Ç—å–º–∞–Ω", minXp: 1500, icon: "üëë" }
            ];

            const currentRank = useMemo(() => {
                return [...ranks].reverse().find(r => xp >= r.minXp) || ranks[0];
            }, [xp]);

            const nextRank = ranks[ranks.indexOf(currentRank) + 1];
            const progressToNext = nextRank 
                ? ((xp - currentRank.minXp) / (nextRank.minXp - currentRank.minXp)) * 100 
                : 100;

            const initialMonuments = [
                {
                    id: 1,
                    image: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/61/80-391-0151_Kyiv_St.Sophia%27s_Cathedral_RB_18_2_%28cropped%29.jpg/800px-80-391-0151_Kyiv_St.Sophia%27s_Cathedral_RB_18_2_%28cropped%29.jpg",
                    name: "–°–æ—Ñ—ñ–π—Å—å–∫–∏–π —Å–æ–±–æ—Ä",
                    year: "1037 —Ä.",
                    dateOrder: 1037,
                    era: "–†—É—Å—å-–£–∫—Ä–∞—ó–Ω–∞ (–Ø—Ä–æ—Å–ª–∞–≤ –ú—É–¥—Ä–∏–π)",
                    description: "–ì–æ–ª–æ–≤–Ω–∏–π —Ö—Ä–∞–º –ö–∏—ó–≤—Å—å–∫–æ—ó –†—É—Å—ñ, –º—ñ—Å—Ü–µ –∫–æ—Ä–æ–Ω–∞—Ü—ñ—ó —Ç–∞ –ø–æ—Ö–æ–≤–∞–Ω–Ω—è –∫–Ω—è–∑—ñ–≤."
                },
                {
                    id: 7, 
                    image: "https://upload.wikimedia.org/wikipedia/commons/8/8a/Golden_Gate_Kiev_2018_G1.jpg",
                    name: "–ó–æ–ª–æ—Ç—ñ –≤–æ—Ä–æ—Ç–∞",
                    year: "1037 —Ä.",
                    dateOrder: 1037,
                    era: "–†—É—Å—å-–£–∫—Ä–∞—ó–Ω–∞ (–Ø—Ä–æ—Å–ª–∞–≤ –ú—É–¥—Ä–∏–π)",
                    description: "–ì–æ–ª–æ–≤–Ω–∞ –±—Ä–∞–º–∞ —Å—Ç–∞—Ä–æ–¥–∞–≤–Ω—å–æ–≥–æ –ö–∏—î–≤–∞, –ø–∞–º'—è—Ç–∫–∞ –æ–±–æ—Ä–æ–Ω–Ω–æ—ó –∑–æ–¥—á–µ—Å—Ç–≤–∞."
                },
                {
                    id: 6, 
                    image: "https://karpaty.love/uploads/posts/2017-12/x1513090759_vyd-na-kamjanec-podilsku-fortecju.jpg.pagespeed.ic.gaRcOEgqTj.webp",
                    name: "–ö–∞–º'—è–Ω–µ—Ü—å–∫–∞ —Ñ–æ—Ä—Ç–µ—Ü—è",
                    year: "XIV —Å—Ç.",
                    dateOrder: 1360,
                    era: "–õ–∏—Ç–æ–≤—Å—å–∫–æ-–ø–æ–ª—å—Å—å–∫–∞ –¥–æ–±–∞",
                    description: "–û–¥–Ω–∞ –∑ –Ω–∞–π–Ω–µ–ø—Ä–∏—Å—Ç—É–ø–Ω—ñ—à–∏—Ö —Ñ–æ—Ä—Ç–µ—Ü—å –£–∫—Ä–∞—ó–Ω–∏, ¬´–∫–≤—ñ—Ç–∫–∞ –Ω–∞ –∫–∞–º–µ–Ω—ñ¬ª."
                },
                {
                    id: 8, 
                    image: "https://upload.wikimedia.org/wikipedia/commons/1/14/%D0%97%D0%B0%D0%BC%D0%BE%D0%BA_%D1%96%D0%B7_%D0%B2%D0%B8%D1%81%D0%BE%D1%82%D0%B8_%D0%BF%D1%82%D0%B0%D1%88%D0%B8%D0%BD%D0%BE%D0%B3%D0%BE_%D0%BF%D0%BE%D0%BB%D1%8C%D0%BE%D1%82%D1%83_1.JPG",
                    name: "–ó–∞–º–æ–∫ –ü–∞–ª–∞–Ω–æ–∫",
                    year: "XIV —Å—Ç.",
                    dateOrder: 1396,
                    era: "–°–µ—Ä–µ–¥–Ω—å–æ–≤—ñ—á—á—è (–ú—É–∫–∞—á–µ–≤–æ)",
                    description: "–£–Ω—ñ–∫–∞–ª—å–Ω–∏–π –∑—Ä–∞–∑–æ–∫ —Å–µ—Ä–µ–¥–Ω—å–æ–≤—ñ—á–Ω–æ—ó —Ñ–æ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ–π–Ω–æ—ó –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏ –Ω–∞ –≥–æ—Ä—ñ –≤—É–ª–∫–∞–Ω—ñ—á–Ω–æ–≥–æ –ø–æ—Ö–æ–¥–∂–µ–Ω–Ω—è."
                },
                {
                    id: 2,
                    image: "https://hortica.zp.ua/images/sich.jpg",
                    name: "–ó–∞–ø–æ—Ä–æ–∑—å–∫–∞ –°—ñ—á",
                    year: "1556 —Ä.",
                    dateOrder: 1556,
                    era: "–ö–æ–∑–∞—Ü—å–∫–∞ –¥–æ–±–∞",
                    description: "–í—ñ–π—Å—å–∫–æ–≤–æ-–ø–æ–ª—ñ—Ç–∏—á–Ω–∏–π —Ü–µ–Ω—Ç—Ä —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ–≥–æ –∫–æ–∑–∞—Ü—Ç–≤–∞ –Ω–∞ –æ—Å—Ç—Ä–æ–≤—ñ –•–æ—Ä—Ç–∏—Ü—è."
                },
                {
                    id: 5,
                    image: "https://cdn.shortpixel.ai/client/to_webp,q_glossy,ret_img/https://www.ukraine-is.com/wp-content/uploads/2016/11/%D0%A0%D0%B5%D0%B7%D0%B8%D0%B4%D0%B5%D0%BD%D1%86%D0%B8%D1%8F-%D0%BC%D0%B8%D1%82%D1%80%D0%BE%D0%BF%D0%BE%D0%BB%D0%B8%D1%82%D0%BE%D0%B2_%D0%91%D1%83%D0%BA%D0%BE%D0%B2%D0%B8%D0%BD%D1%8B-%D0%B8-%D0%94%D0%B0%D0%BB%D0%BC%D0%B0%D1%86%D0%B8%D0%B8.jpg",
                    name: "–†–µ–∑–∏–¥–µ–Ω—Ü—ñ—è –º–∏—Ç—Ä–æ–ø–æ–ª–∏—Ç—ñ–≤",
                    year: "1882 —Ä.",
                    dateOrder: 1882,
                    era: "–ï–∫–ª–µ–∫—Ç–∏–∫–∞ (–ß–µ—Ä–Ω—ñ–≤—Ü—ñ)",
                    description: "–ù–∏–Ω—ñ –ß–µ—Ä–Ω—ñ–≤–µ—Ü—å–∫–∏–π —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç, –æ–±'—î–∫—Ç —Å–ø–∞–¥—â–∏–Ω–∏ –Æ–ù–ï–°–ö–û."
                },
                {
                    id: 9, 
                    image: "https://upload.wikimedia.org/wikipedia/commons/6/67/%D0%9B%D1%8C%D0%B2%D1%96%D0%B2%D1%81%D1%8C%D0%BA%D0%B8%D0%B9_%D0%BD%D0%B0%D1%86%D1%96%D0%BE%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D0%B8%D0%B9_%D0%B0%D0%BA%D0%B0%D0%B4%D0%B5%D0%BC%D1%96%D1%87%D0%BD%D0%B8%D0%B9_%D1%82%D0%B5%D0%B0%D1%82%D1%80_%D0%BE%D0%BF%D0%B5%D1%80%D0%B8_%D1%82%D0%B0_%D0%B1%D0%B0%D0%BB%D0%B5%D1%82%D1%83_%D1%96%D0%BC%D0%B5%D0%BD%D1%96_%D0%A1%D0%BE%D0%BB%D0%BE%D0%BC%D1%96%D1%97_%D0%9A%D1%80%D1%83%D1%88%D0%B5%D0%BB%D1%8C%D0%BD%D0%B8%D1%86%D1%8C%D0%BA%D0%BE%D1%97_13.jpg",
                    name: "–õ—å–≤—ñ–≤—Å—å–∫–∞ –æ–ø–µ—Ä–∞",
                    year: "1900 —Ä.",
                    dateOrder: 1900,
                    era: "–ù–µ–æ—Ä–µ–Ω–µ—Å–∞–Ω—Å (–õ—å–≤—ñ–≤)",
                    description: "–û–¥–∏–Ω –∑ –Ω–∞–π–∫—Ä–∞—Å–∏–≤—ñ—à–∏—Ö –æ–ø–µ—Ä–Ω–∏—Ö —Ç–µ–∞—Ç—Ä—ñ–≤ –Ñ–≤—Ä–æ–ø–∏, –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–∞ –ø–µ—Ä–ª–∏–Ω–∞ –õ—å–≤–æ–≤–∞."
                },
                {
                    id: 4,
                    image: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/02/%D0%91%D1%83%D0%B4%D0%B8%D0%BD%D0%BE%D0%BA_%D1%96%D0%B7_%D1%85%D0%B8%D0%BC%D0%B5%D1%80%D0%B0%D0%BC%2C_%D0%B2_%D1%8F%D0%BA%D0%BE%D0%BC%D1%83_%D0%B6%D0%B8%D0%B2_%D0%B0%D1%80%D1%85%D1%96%D1%82%D0%B5%D0%BA%D1%82%D0%BE%D1%80_%D0%93%D0%BE%D1%80%D0%BE%D0%B4%D0%B5%D1%86%D1%8C%D0%BA%D0%B8%D0%B9.jpg/640px-%D0%91%D1%83%D0%B4%D0%B8%D0%BD%D0%BE%D0%BA_%D1%96%D0%B7_%D1%85%D0%B8%D0%BC%D0%B5%D1%80%D0%B0%D0%BC%2C_%D0%B2_%D1%8F%D0%BA%D0%BE%D0%BC%D1%83_%D0%B6%D0%B8%D0%B2_%D0%B0%D1%80%D1%85%D1%96%D1%82%D0%B5%D0%BA%D1%82%D0%BE%D1%80_%D0%93%D0%BE%D1%80%D0%BE%D0%B4%D0%B5%D1%86%D1%8C%D0%BA%D0%B8%D0%B9.jpg",
                    name: "–ë—É–¥–∏–Ω–æ–∫ –∑ —Ö–∏–º–µ—Ä–∞–º–∏",
                    year: "1903 —Ä.",
                    dateOrder: 1903,
                    era: "–°—Ç–∏–ª—å –ú–æ–¥–µ—Ä–Ω",
                    description: "–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–∏–π —à–µ–¥–µ–≤—Ä –í–ª–∞–¥–∏—Å–ª–∞–≤–∞ –ì–æ—Ä–æ–¥–µ—Ü—å–∫–æ–≥–æ –≤ –ö–∏—î–≤—ñ."
                },
                {
                    id: 3,
                    image: "https://inside-ua.com/files/originals/monument-nezalezhnosti-2.webp",
                    name: "–ú–æ–Ω—É–º–µ–Ω—Ç –ù–µ–∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ",
                    year: "2001 —Ä.",
                    dateOrder: 2001,
                    era: "–°—É—á–∞—Å–Ω–∞ –£–∫—Ä–∞—ó–Ω–∞",
                    description: "–°–∏–º–≤–æ–ª —Å–≤–æ–±–æ–¥–∏, –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π –Ω–∞ —á–µ—Å—Ç—å 10-—Ä—ñ—á—á—è –Ω–µ–∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ."
                }
            ];

            const quizQuestions = [
                {
                    question: "–•—Ç–æ –∑ –∫–Ω—è–∑—ñ–≤ –∑–∞—Å–Ω—É–≤–∞–≤ –°–æ—Ñ—ñ–π—Å—å–∫–∏–π —Å–æ–±–æ—Ä?",
                    options: ["–í–æ–ª–æ–¥–∏–º–∏—Ä –í–µ–ª–∏–∫–∏–π", "–Ø—Ä–æ—Å–ª–∞–≤ –ú—É–¥—Ä–∏–π", "–î–∞–Ω–∏–ª–æ –ì–∞–ª–∏—Ü—å–∫–∏–π", "–°–≤—è—Ç–æ—Å–ª–∞–≤ –•–æ—Ä–æ–±—Ä–∏–π"],
                    correct: 1
                },
                {
                    question: "–£ —è–∫–æ–º—É —Å—Ç–∏–ª—ñ –∑–±—É–¥–æ–≤–∞–Ω–æ –ë—É–¥–∏–Ω–æ–∫ –∑ —Ö–∏–º–µ—Ä–∞–º–∏?",
                    options: ["–ë–∞—Ä–æ–∫–æ", "–ì–æ—Ç–∏–∫–∞", "–ú–æ–¥–µ—Ä–Ω", "–ö–ª–∞—Å–∏—Ü–∏–∑–º"],
                    correct: 2
                },
                {
                    question: "–í —è–∫–æ–º—É –º—ñ—Å—Ç—ñ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –†–µ–∑–∏–¥–µ–Ω—Ü—ñ—è –º–∏—Ç—Ä–æ–ø–æ–ª–∏—Ç—ñ–≤?",
                    options: ["–õ—å–≤—ñ–≤", "–ö–∏—ó–≤", "–ß–µ—Ä–Ω—ñ–≤—Ü—ñ", "–û–¥–µ—Å–∞"],
                    correct: 2
                },
                {
                    question: "–Ø–∫–∞ —Ñ–æ—Ä—Ç–µ—Ü—è –≤—ñ–¥–æ–º–∞ —è–∫ '–ö–≤—ñ—Ç–∫–∞ –Ω–∞ –∫–∞–º–µ–Ω—ñ'?",
                    options: ["–•–æ—Ç–∏–Ω—Å—å–∫–∞", "–ö–∞–º'—è–Ω–µ—Ü—å-–ü–æ–¥—ñ–ª—å—Å—å–∫–∞", "–ê–∫–∫–µ—Ä–º–∞–Ω—Å—å–∫–∞", "–ú–µ–¥–∂–∏–±—ñ–∑—å–∫–∞"],
                    correct: 1
                },
                {
                    question: "–Ø–∫–∏–π –æ–±'—î–∫—Ç —î —Å–∏–º–≤–æ–ª–æ–º –∫–æ–∑–∞—Ü—å–∫–æ—ó –≤–æ–ª—å–Ω–∏—Ü—ñ?",
                    options: ["–°–æ—Ñ—ñ–π—Å—å–∫–∏–π —Å–æ–±–æ—Ä", "–ó–æ–ª–æ—Ç—ñ –≤–æ—Ä–æ—Ç–∞", "–ó–∞–ø–æ—Ä–æ–∑—å–∫–∞ –°—ñ—á", "–ö–∏—î–≤–æ-–ü–µ—á–µ—Ä—Å—å–∫–∞ –ª–∞–≤—Ä–∞"],
                    correct: 2
                },
                {
                    question: "–î–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –∑–∞–º–æ–∫ –ü–∞–ª–∞–Ω–æ–∫?",
                    options: ["–£–∂–≥–æ—Ä–æ–¥", "–ú—É–∫–∞—á–µ–≤–æ", "–•—É—Å—Ç", "–õ—å–≤—ñ–≤"],
                    correct: 1
                },
                {
                    question: "–Ø–∫–∞ —Å–ø–æ—Ä—É–¥–∞ –±—É–ª–∞ –≥–æ–ª–æ–≤–Ω–∏–º –≤'—ó–∑–¥–æ–º –¥–æ —Å—Ç–∞—Ä–æ–¥–∞–≤–Ω—å–æ–≥–æ –ö–∏—î–≤–∞?",
                    options: ["–ó–æ–ª–æ—Ç—ñ –≤–æ—Ä–æ—Ç–∞", "–õ—è–¥—Å—å–∫—ñ –≤–æ—Ä–æ—Ç–∞", "–ñ–∏–¥—ñ–≤—Å—å–∫—ñ –≤–æ—Ä–æ—Ç–∞", "–°–æ—Ñ—ñ–π—Å—å–∫—ñ –≤–æ—Ä–æ—Ç–∞"],
                    correct: 0
                }
            ];

            const [monuments, setMonuments] = useState(initialMonuments);
            const [currentQ, setCurrentQ] = useState(0);
            const [score, setScore] = useState(0);
            const [showResult, setShowResult] = useState(false);
            const [selectedOption, setSelectedOption] = useState(null);
            const [isAnswered, setIsAnswered] = useState(false);
            const [flippedCards, setFlippedCards] = useState({});

            const [memoryCards, setMemoryCards] = useState([]);
            const [memoryFlipped, setMemoryFlipped] = useState([]);
            const [memoryMatched, setMemoryMatched] = useState([]);
            const [memoryMoves, setMemoryMoves] = useState(0);
            const [isMemoryWon, setIsMemoryWon] = useState(false);

            useEffect(() => {
                if (isDark) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            }, [isDark]);

            const shuffleCards = () => {
                const shuffled = [...monuments].sort(() => Math.random() - 0.5);
                setMonuments(shuffled);
                setFlippedCards({}); 
            };

            const toggleCard = (id) => {
                setFlippedCards(prev => ({ ...prev, [id]: !prev[id] }));
                if (!visitedCards.has(id)) {
                    setVisitedCards(prev => new Set(prev).add(id));
                    setXp(prev => prev + 15);
                }
            };

            const startMemoryGame = () => {
                const selection = [...initialMonuments].sort(() => Math.random() - 0.5).slice(0, 6);
                const deck = selection.flatMap(item => [
                    { id: item.id, type: 'image', content: item.image, uniqueId: Math.random() },
                    { id: item.id, type: 'text', content: item.name, uniqueId: Math.random() }
                ]);
                setMemoryCards(deck.sort(() => Math.random() - 0.5));
                setMemoryFlipped([]);
                setMemoryMatched([]);
                setMemoryMoves(0);
                setIsMemoryWon(false);
            };

            const handleMemoryClick = (index) => {
                if (memoryFlipped.length === 2 || memoryFlipped.includes(index) || memoryMatched.includes(memoryCards[index].id)) return;
                const newFlipped = [...memoryFlipped, index];
                setMemoryFlipped(newFlipped);
                if (newFlipped.length === 2) {
                    setMemoryMoves(prev => prev + 1);
                    const card1 = memoryCards[newFlipped[0]];
                    const card2 = memoryCards[newFlipped[1]];
                    if (card1.id === card2.id) {
                        setMemoryMatched(prev => [...prev, card1.id]);
                        setMemoryFlipped([]);
                        setXp(prev => prev + 20);
                        if (memoryMatched.length + 1 === memoryCards.length / 2) {
                            setIsMemoryWon(true);
                            setXp(prev => prev + 100);
                        }
                    } else {
                        setTimeout(() => setMemoryFlipped([]), 1000);
                    }
                }
            };

            useEffect(() => {
                if (activeTab === 'memory') startMemoryGame();
            }, [activeTab]);

            const handleAnswer = (index) => {
                if (isAnswered) return;
                setSelectedOption(index);
                setIsAnswered(true);
                if (index === quizQuestions[currentQ].correct) {
                    setScore(prev => prev + 1);
                    setXp(prev => prev + 50); 
                } else {
                    setXp(prev => prev + 5); 
                }
            };

            const nextQuestion = () => {
                if (currentQ < quizQuestions.length - 1) {
                    setCurrentQ(prev => prev + 1);
                    setSelectedOption(null);
                    setIsAnswered(false);
                } else {
                    setShowResult(true);
                    setXp(prev => prev + 100);
                }
            };

            const resetQuiz = () => {
                setCurrentQ(0);
                setScore(0);
                setShowResult(false);
                setSelectedOption(null);
                setIsAnswered(false);
            };

            const timelineData = [...initialMonuments].sort((a, b) => a.dateOrder - b.dateOrder);

            const Confetti = () => (
                <div className="fixed inset-0 pointer-events-none z-50 overflow-hidden flex justify-center">
                    {[...Array(20)].map((_, i) => (
                        <div key={i} className={`absolute top-[-20px] w-3 h-3 rounded-full opacity-0`} 
                            style={{
                                backgroundColor: i % 2 === 0 ? '#FFD700' : '#0057B7',
                                left: `${Math.random() * 100}%`,
                                animation: `fall ${2 + Math.random() * 2}s linear infinite`,
                                animationDelay: `${Math.random() * 2}s`
                            }} 
                        />
                    ))}
                </div>
            );

            return (
                <div className={`min-h-screen transition-colors duration-500 font-sans ${isDark ? 'bg-slate-900 text-white' : 'bg-slate-50 text-slate-800'}`}>
                
                    {/* Header */}
                    <header className={`sticky top-0 z-40 backdrop-blur-md shadow-sm border-b transition-colors duration-300 ${isDark ? 'bg-slate-900/90 border-slate-700' : 'bg-white/90 border-slate-200'}`}>
                        <div className="max-w-7xl mx-auto px-4 py-3">
                            <div className="flex flex-col md:flex-row justify-between items-center gap-4">
                                <div className="flex items-center gap-2 self-start md:self-auto">
                                    <div className="w-10 h-10 bg-gradient-to-br from-blue-500 to-yellow-400 rounded-lg flex items-center justify-center text-white font-bold text-xl shadow-lg">UA</div>
                                    <h1 className="text-xl font-bold tracking-tight">History<span className="text-blue-600 dark:text-blue-400">Trainer</span></h1>
                                </div>

                                {/* Rank Bar */}
                                <div className={`flex items-center gap-3 px-4 py-2 rounded-full border ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-slate-50 border-slate-200'}`}>
                                    <div className="flex items-center gap-2">
                                        <span className="text-xl">{currentRank.icon}</span>
                                        <div className="flex flex-col">
                                            <span className="text-xs font-bold uppercase tracking-wider opacity-60">–†–∞–Ω–≥</span>
                                            <span className="font-bold text-sm leading-none">{currentRank.name}</span>
                                        </div>
                                    </div>
                                    <div className="h-8 w-px bg-slate-300 dark:bg-slate-600 mx-2"></div>
                                    <div className="flex flex-col w-32">
                                        <div className="flex justify-between text-xs font-medium mb-1">
                                            <span>XP: {xp}</span>
                                            {nextRank && <span>{nextRank.minXp}</span>}
                                        </div>
                                        <div className="h-2 w-full bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
                                            <div className="h-full bg-gradient-to-r from-yellow-400 to-orange-500 transition-all duration-500" style={{ width: `${progressToNext}%` }}></div>
                                        </div>
                                    </div>
                                </div>

                                {/* Controls */}
                                <div className="flex items-center gap-2 self-end md:self-auto">
                                    <div className={`flex p-1 rounded-xl ${isDark ? 'bg-slate-800' : 'bg-slate-100'}`}>
                                        <button onClick={() => setActiveTab('cards')} className={`p-2 rounded-lg transition-all ${activeTab === 'cards' ? 'bg-white dark:bg-slate-600 shadow-sm text-blue-600 dark:text-blue-400' : 'text-slate-500'}`}><IconBookOpen size={20} /></button>
                                        <button onClick={() => setActiveTab('timeline')} className={`p-2 rounded-lg transition-all ${activeTab === 'timeline' ? 'bg-white dark:bg-slate-600 shadow-sm text-blue-600 dark:text-blue-400' : 'text-slate-500'}`}><IconClock size={20} /></button>
                                        <button onClick={() => setActiveTab('memory')} className={`p-2 rounded-lg transition-all ${activeTab === 'memory' ? 'bg-white dark:bg-slate-600 shadow-sm text-blue-600 dark:text-blue-400' : 'text-slate-500'}`}><IconGrid size={20} /></button>
                                        <button onClick={() => setActiveTab('quiz')} className={`p-2 rounded-lg transition-all ${activeTab === 'quiz' ? 'bg-white dark:bg-slate-600 shadow-sm text-blue-600 dark:text-blue-400' : 'text-slate-500'}`}><IconGraduationCap size={20} /></button>
                                    </div>
                                    <button onClick={() => setIsDark(!isDark)} className={`p-2 rounded-full transition-transform hover:rotate-12 hover:bg-slate-100 dark:hover:bg-slate-800 border ${isDark ? 'border-slate-700' : 'border-slate-200'}`}>
                                        {isDark ? <IconSun size={20} className="text-yellow-400" /> : <IconMoon size={20} className="text-slate-600" />}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="max-w-7xl mx-auto px-4 py-8">
                        {/* TAB: CARDS */}
                        {activeTab === 'cards' && (
                            <div className="animate-in fade-in slide-in-from-bottom-4 duration-500">
                                <div className="text-center mb-10">
                                    <h2 className="text-3xl font-extrabold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-yellow-500">–í–∏–≤—á–∞–π –ø–∞–º'—è—Ç–∫–∏</h2>
                                    <p className={`max-w-2xl mx-auto ${isDark ? 'text-slate-400' : 'text-slate-600'}`}>–ù–∞—Ç–∏—Å–∫–∞–π –Ω–∞ –∫–∞—Ä—Ç–∫–∏, —â–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è –¥–∞—Ç—É —Ç–∞ –µ–ø–æ—Ö—É. –ó–∞ –∫–æ–∂–Ω—É –Ω–æ–≤—É –∫–∞—Ä—Ç–∫—É +15 XP.</p>
                                    <button onClick={shuffleCards} className="mt-6 inline-flex items-center gap-2 px-6 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-full font-medium transition-all hover:shadow-lg active:scale-95"><IconShuffle size={18} />–ü–µ—Ä–µ–º—ñ—à–∞—Ç–∏</button>
                                </div>
                                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 pb-10">
                                    {monuments.map((item) => (
                                        <div key={item.id} onClick={() => toggleCard(item.id)} className="group h-[400px] w-full perspective-1000 cursor-pointer">
                                            <div className={`relative h-full w-full transition-all duration-700 transform-style-3d ${flippedCards[item.id] ? 'rotate-y-180' : ''}`}>
                                                <div className={`absolute inset-0 w-full h-full rounded-2xl overflow-hidden shadow-xl backface-hidden border ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-100'}`}>
                                                    <img src={item.image} alt={item.name} className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" />
                                                    <div className="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-90"></div>
                                                    {!visitedCards.has(item.id) && <div className="absolute top-4 right-4 bg-yellow-400 text-black text-xs font-bold px-2 py-1 rounded-full animate-bounce shadow-lg">+15 XP</div>}
                                                    <div className="absolute bottom-0 left-0 right-0 p-6 text-white">
                                                        <div className="flex items-center gap-2 text-yellow-400 text-sm font-bold uppercase tracking-wider mb-1"><IconHelpCircle size={14} />–ù–∞—Ç–∏—Å–Ω–∏</div>
                                                        <h3 className="text-2xl font-bold">{item.name}</h3>
                                                    </div>
                                                </div>
                                                <div className={`absolute inset-0 w-full h-full rounded-2xl p-8 flex flex-col items-center justify-center text-center rotate-y-180 backface-hidden bg-gradient-to-br ${isDark ? 'from-slate-800 to-slate-900 border border-slate-700' : 'from-blue-600 to-blue-800 text-white shadow-2xl'}`}>
                                                    <h3 className="text-2xl font-bold mb-2">{item.name}</h3>
                                                    <div className="w-16 h-1 bg-yellow-400 rounded-full my-6"></div>
                                                    <div className="space-y-4">
                                                        <div>
                                                            <p className={`text-xs uppercase tracking-widest opacity-70 ${isDark ? 'text-slate-400' : 'text-blue-200'}`}>–†—ñ–∫ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è</p>
                                                            <p className="text-3xl font-extrabold text-yellow-400">{item.year}</p>
                                                        </div>
                                                        <div>
                                                            <p className={`text-xs uppercase tracking-widest opacity-70 ${isDark ? 'text-slate-400' : 'text-blue-200'}`}>–Ü—Å—Ç–æ—Ä–∏—á–Ω–∞ –¥–æ–±–∞</p>
                                                            <p className="text-lg font-medium">{item.era}</p>
                                                        </div>
                                                    </div>
                                                    <p className={`mt-6 text-sm italic opacity-80 ${isDark ? 'text-slate-300' : 'text-blue-100'}`}>{item.description}</p>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* TAB: TIMELINE */}
                        {activeTab === 'timeline' && (
                            <div className="animate-in fade-in slide-in-from-bottom-4 duration-500 max-w-4xl mx-auto">
                                <div className="text-center mb-12">
                                    <h2 className="text-3xl font-extrabold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-purple-500 to-pink-500">–ü–æ–¥–æ—Ä–æ–∂ —É —á–∞—Å—ñ</h2>
                                    <p className={`max-w-2xl mx-auto ${isDark ? 'text-slate-400' : 'text-slate-600'}`}>–•—Ä–æ–Ω–æ–ª–æ–≥—ñ—è —Ä–æ–∑–≤–∏—Ç–∫—É —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—ó –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏ —Ç–∞ —ñ—Å—Ç–æ—Ä—ñ—ó.</p>
                                </div>
                                <div className="relative">
                                    <div className={`absolute left-4 md:left-1/2 top-0 bottom-0 w-1 ${isDark ? 'bg-slate-700' : 'bg-slate-200'} md:-ml-0.5`}></div>
                                    <div className="space-y-12">
                                        {timelineData.map((item, index) => {
                                            const isEven = index % 2 === 0;
                                            return (
                                                <div key={item.id} className={`relative flex items-center md:justify-between ${isEven ? 'md:flex-row-reverse' : ''}`}>
                                                    <div className={`absolute left-4 md:left-1/2 w-8 h-8 rounded-full border-4 z-10 flex items-center justify-center -translate-x-1/2 md:translate-x-[-50%] ${isDark ? 'bg-slate-900 border-blue-500' : 'bg-white border-blue-500'}`}>
                                                        <div className="w-2.5 h-2.5 bg-blue-500 rounded-full"></div>
                                                    </div>
                                                    <div className="hidden md:block w-1/2"></div>
                                                    <div className="w-full md:w-5/12 pl-12 md:pl-0">
                                                        <div className={`p-4 rounded-xl border shadow-lg hover:shadow-xl transition-shadow ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-100'} group`}>
                                                            <div className="relative h-40 overflow-hidden rounded-lg mb-4">
                                                                <img src={item.image} alt={item.name} className="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" />
                                                                <div className="absolute top-2 left-2 bg-black/60 backdrop-blur-sm text-white text-xs px-2 py-1 rounded">{item.year}</div>
                                                            </div>
                                                            <h3 className="text-xl font-bold mb-1">{item.name}</h3>
                                                            <p className={`text-sm ${isDark ? 'text-slate-400' : 'text-slate-500'}`}>{item.era}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                    <div className="relative mt-12 flex justify-center">
                                        <div className={`px-4 py-2 rounded-full border text-sm font-medium ${isDark ? 'bg-slate-800 border-slate-700 text-slate-300' : 'bg-white border-slate-200 text-slate-600'}`}>–°—å–æ–≥–æ–¥–Ω—ñ</div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* TAB: MEMORY GAME */}
                        {activeTab === 'memory' && (
                            <div className="animate-in fade-in slide-in-from-bottom-4 duration-500 max-w-4xl mx-auto">
                                <div className="text-center mb-8">
                                    <h2 className="text-3xl font-extrabold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-green-500 to-teal-500">–ó–Ω–∞–π–¥–∏ –ø–∞—Ä—É</h2>
                                    <div className="flex justify-center gap-6 text-sm font-medium">
                                        <span className="flex items-center gap-2 bg-slate-100 dark:bg-slate-800 px-3 py-1 rounded-full"><IconRotateCcw size={14} /> –•–æ–¥–∏: {memoryMoves}</span>
                                        <span className="flex items-center gap-2 bg-slate-100 dark:bg-slate-800 px-3 py-1 rounded-full">–ü–∞—Ä–∏: {memoryMatched.length} / 6</span>
                                    </div>
                                </div>
                                {isMemoryWon ? (
                                    <div className="text-center p-12 bg-white dark:bg-slate-800 rounded-3xl shadow-xl border border-slate-200 dark:border-slate-700">
                                        <Confetti /><div className="mx-auto text-yellow-400 mb-6 flex justify-center"><IconTrophy size={64} /></div>
                                        <h3 className="text-3xl font-bold mb-4">–ü–µ—Ä–µ–º–æ–≥–∞!</h3>
                                        <p className="text-lg mb-8 opacity-80">–¢–∏ –∑–Ω–∞–π—à–æ–≤ —É—Å—ñ –ø–∞—Ä–∏ –∑–∞ {memoryMoves} —Ö–æ–¥—ñ–≤!</p>
                                        <button onClick={startMemoryGame} className="px-8 py-3 bg-green-600 hover:bg-green-700 text-white rounded-xl font-bold flex items-center gap-2 mx-auto"><IconPlay size={20} /> –ì—Ä–∞—Ç–∏ –∑–Ω–æ–≤—É</button>
                                    </div>
                                ) : (
                                    <div className="grid grid-cols-3 sm:grid-cols-4 gap-4">
                                        {memoryCards.map((card, index) => {
                                            const isFlipped = memoryFlipped.includes(index) || memoryMatched.includes(card.id);
                                            return (
                                                <div key={card.uniqueId} onClick={() => handleMemoryClick(index)} className="aspect-[3/4] cursor-pointer perspective-1000 relative group">
                                                    <div className={`w-full h-full transition-all duration-500 transform-style-3d ${isFlipped ? 'rotate-y-180' : ''} relative`}>
                                                        <div className={`absolute inset-0 backface-hidden flex items-center justify-center rounded-xl shadow-md border-2 ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-100'} group-hover:border-blue-400`}><div className="w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-yellow-400 opacity-20"></div></div>
                                                        <div className={`absolute inset-0 backface-hidden rotate-y-180 rounded-xl overflow-hidden shadow-lg border-2 ${memoryMatched.includes(card.id) ? 'border-green-500' : 'border-blue-500'} bg-white dark:bg-slate-800 flex items-center justify-center p-2 text-center`}>
                                                            {card.type === 'image' ? <img src={card.content} className="w-full h-full object-cover rounded-lg" /> : <span className="font-bold text-sm md:text-base">{card.content}</span>}
                                                            {memoryMatched.includes(card.id) && <div className="absolute inset-0 bg-green-500/20 flex items-center justify-center"><IconCheckCircle className="text-green-600 w-12 h-12" /></div>}
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}
                            </div>
                        )}

                        {/* TAB: QUIZ */}
                        {activeTab === 'quiz' && (
                            <div className="max-w-2xl mx-auto animate-in fade-in slide-in-from-bottom-4 duration-500">
                                {!showResult ? (
                                    <div className={`rounded-2xl shadow-xl overflow-hidden border ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-100'}`}>
                                        <div className="h-2 w-full bg-slate-200 dark:bg-slate-700">
                                            <div className="h-full bg-gradient-to-r from-blue-500 to-yellow-400 transition-all duration-500 ease-out" style={{ width: `${((currentQ) / quizQuestions.length) * 100}%` }}></div>
                                        </div>
                                        <div className="p-8">
                                            <div className="flex justify-between items-center mb-6">
                                                <span className={`text-sm font-semibold px-3 py-1 rounded-full ${isDark ? 'bg-slate-700 text-blue-400' : 'bg-blue-50 text-blue-600'}`}>–ü–∏—Ç–∞–Ω–Ω—è {currentQ + 1} –∑ {quizQuestions.length}</span>
                                                <div className="flex gap-4"><span className="text-sm text-slate-400 font-medium flex items-center gap-1"><IconStar size={14} className="text-yellow-500"/> XP: {xp}</span><span className="text-sm text-slate-400 font-medium">–ë–∞–ª–∏: {score}</span></div>
                                            </div>
                                            <h3 className="text-2xl font-bold mb-8 leading-tight">{quizQuestions[currentQ].question}</h3>
                                            <div className="space-y-3">
                                                {quizQuestions[currentQ].options.map((opt, idx) => {
                                                    let btnClass = "w-full p-4 rounded-xl text-left font-medium transition-all duration-200 flex justify-between items-center border-2 ";
                                                    if (isAnswered) {
                                                        if (idx === quizQuestions[currentQ].correct) btnClass += "border-green-500 bg-green-50 text-green-700 dark:bg-green-900/30 dark:text-green-400 ";
                                                        else if (idx === selectedOption) btnClass += "border-red-500 bg-red-50 text-red-700 dark:bg-red-900/30 dark:text-red-400 ";
                                                        else btnClass += "border-transparent opacity-50 ";
                                                    } else btnClass += `border-transparent hover:border-blue-300 hover:bg-blue-50 dark:hover:bg-slate-700 ${isDark ? 'bg-slate-700/50' : 'bg-slate-100'}`;
                                                    return <button key={idx} onClick={() => handleAnswer(idx)} disabled={isAnswered} className={btnClass}>{opt}{isAnswered && idx === quizQuestions[currentQ].correct && <IconCheckCircle className="text-green-500" />}{isAnswered && idx === selectedOption && idx !== quizQuestions[currentQ].correct && <IconXCircle className="text-red-500" />}</button>;
                                                })}
                                            </div>
                                        </div>
                                        <div className={`p-6 border-t flex justify-end ${isDark ? 'bg-slate-900/50' : 'bg-slate-50'}`}>
                                            <button onClick={nextQuestion} disabled={!isAnswered} className={`px-8 py-3 rounded-xl font-bold transition-all ${isAnswered ? 'bg-blue-600 text-white shadow-lg' : 'bg-slate-300 text-slate-500 cursor-not-allowed'}`}>{currentQ === quizQuestions.length - 1 ? "–ó–∞–≤–µ—Ä—à–∏—Ç–∏" : "–î–∞–ª—ñ"}</button>
                                        </div>
                                    </div>
                                ) : (
                                    <div className={`text-center p-10 rounded-3xl border shadow-2xl relative overflow-hidden ${isDark ? 'bg-slate-800 border-slate-700' : 'bg-white'}`}>
                                        {score === quizQuestions.length && <Confetti />}
                                        <div className="relative z-10">
                                            <div className={`w-24 h-24 mx-auto rounded-full flex items-center justify-center mb-6 text-4xl shadow-xl ${score > quizQuestions.length / 2 ? 'bg-gradient-to-br from-green-400 to-green-600' : 'bg-gradient-to-br from-orange-400 to-red-500'} text-white`}><IconTrophy size={40} /></div>
                                            <h2 className="text-3xl font-extrabold mb-2">{score === quizQuestions.length ? "–í—ñ–¥–º—ñ–Ω–Ω–æ!" : score > quizQuestions.length / 2 ? "–•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!" : "–°–ø—Ä–æ–±—É–π —â–µ —Ä–∞–∑!"}</h2>
                                            <div className="flex justify-center items-center gap-4 mb-8">
                                                <div className={`px-4 py-2 rounded-lg border ${isDark ? 'bg-slate-700' : 'bg-slate-50'}`}><span className="block text-xs uppercase opacity-60">–ü—Ä–∞–≤–∏–ª—å–Ω–æ</span><span className="font-bold text-xl">{score}/{quizQuestions.length}</span></div>
                                                <div className="px-4 py-2 rounded-lg border bg-yellow-50 text-yellow-800"><span className="block text-xs uppercase opacity-60">–û—Ç—Ä–∏–º–∞–Ω–æ XP</span><span className="font-bold text-xl">+{score * 50 + 100}</span></div>
                                            </div>
                                            <div className="flex justify-center gap-4">
                                                <button onClick={resetQuiz} className="flex items-center gap-2 px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-bold transition-all active:scale-95"><IconRotateCcw size={20} />–ü—Ä–æ–π—Ç–∏ –∑–Ω–æ–≤—É</button>
                                                <button onClick={() => setActiveTab('memory')} className={`px-8 py-3 rounded-xl font-bold border-2 ${isDark ? 'border-slate-600' : 'border-slate-200'}`}>–ì—Ä–∞—Ç–∏ –≤ Memory</button>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<UAHistoryTrainer />);
    </script>
</body>
</html>
